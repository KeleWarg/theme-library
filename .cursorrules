# Design System Admin - Cursor Rules

## Project Context
You are building a design system admin dashboard that:
- Visualizes design tokens from Figma
- Manages React components through a workflow (pending â†’ generated â†’ approved â†’ published)
- Uses Claude AI to generate React code from Figma component specs
- Exports an npm package with components and LLMS.txt

## Documentation
ALWAYS read the relevant phase doc before implementing:
- `docs/ORCHESTRATOR.md` - Master execution guide
- `docs/phases/PHASE_*.md` - Step-by-step implementation tasks
- `docs/CURSOR_BUILD_GUIDE.md` - Token transformation reference

---

## Theme Management System

This feature follows the **research-first-development methodology** with a structured document harness.

### Document Harness Location
```
docs/theme-management/
â”œâ”€â”€ 00-problem-statement.md      # Why we're building this
â”œâ”€â”€ 01-research-foundation.md    # Figma format spec, provenance table
â”œâ”€â”€ 02-architecture.md           # Phases, data flow, key types
â”œâ”€â”€ 03-chunk-index.md            # All chunks with dependencies + gate status
â”œâ”€â”€ 04-config-reference.md       # All tunable values
â”œâ”€â”€ GATE_CHECKPOINTS.md          # Integration tests + orchestration rules
â””â”€â”€ chunks/
    â””â”€â”€ chunk-X_YY.md            # Individual implementation specs
```

### Before Implementing ANY Theme Management Feature

1. **Read the chunk spec first** â€” Find `docs/theme-management/chunks/chunk-X_YY.md`
2. **Check dependencies** â€” Verify prerequisite chunks are complete
3. **Reference architecture** â€” Review `02-architecture.md` for data flow and type contracts
4. **Use config values** â€” Never hardcode; reference `04-config-reference.md`

### Phase Status
```
âœ… Phase 1: Foundation (1.01 â†’ 1.04)
âœ… Phase 2: Import Flow (2.01 â†’ 2.04)
âœ… Phase 3: Editing (3.01 â†’ 3.05)
âœ… Phase 4: Creation & Export (4.01 â†’ 4.04)
âœ… Phase 5: Integration & Testing (5.01 â†’ 5.03)
â¬œ Phase 6: AI Code Generation (6.01 â†’ 6.06)
â¬œ Phase 7: Export + Dashboard (7.01 â†’ 7.08)
â¬œ Phase 8: AI Platform Export (8.01 â†’ 8.08)
â¬œ Phase 9: Figma Plugin (9.01 â†’ 9.06) â€” INDEPENDENT
```

### Theme Management Key Types
Defined in `docs/theme-management/02-architecture.md`:
- **Theme** â€” Database record for theme metadata
- **ThemeToken** â€” Database record for individual tokens
- **ParsedToken** â€” Parser output structure
- **ParseResult** â€” Parser return with tokens, errors, warnings

### Update Status After Each Chunk
Edit `docs/theme-management/03-chunk-index.md`:
- â¬œ Not started â†’ ðŸ”„ In progress â†’ âœ… Complete

---

## Phases 6-9: New Features

### Phase 6: AI Code Generation
Generate React code from Figma specs using Claude API.

**Files:**
```
src/lib/ai/
â”œâ”€â”€ types.ts           # 6.01
â”œâ”€â”€ config.ts          # 6.01
â”œâ”€â”€ promptBuilder.ts   # 6.02
â””â”€â”€ generateCode.ts    # 6.03
src/components/ui/
â”œâ”€â”€ GenerateButton.jsx # 6.04
â””â”€â”€ FeedbackModal.jsx  # 6.05
```

**Requires:** `VITE_ANTHROPIC_API_KEY` in `.env.local`

### Phase 7: Export + Dashboard
Package export, LLMS.txt, Settings, Dashboard.

**Files:**
```
src/lib/export/        # types, utils, generators
src/lib/dashboard/     # stats
src/components/export/ # ExportModal
src/pages/             # Settings, Dashboard
```

**Requires:** `npm install jszip file-saver`

### Phase 8: AI Platform Export
Export for Cursor, Claude Code, Bolt/Lovable, MCP.

**Files:**
```
src/lib/aiExport/      # generators for each format
src/components/        # AIExportPanel
mcp-server/            # standalone MCP server
```

### Phase 9: Figma Plugin (INDEPENDENT)
Can run parallel to Phases 6-8.

**Files:**
```
figma-variables-exporter/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ ui.html
â””â”€â”€ src/code.ts, exporter.ts, variableReader.ts
```

---

## Agent Orchestration Rules

**Before starting ANY chunk:**
1. Check `03-chunk-index.md` for dependencies
2. ALL dependencies must show âœ…
3. If crossing a phase boundary, run the gate test first

**After completing ANY chunk:**
1. Run tests for that chunk
2. Update status to âœ… in `03-chunk-index.md`
3. Check if a gate checkpoint is triggered
4. If gate triggered, create and run the gate test

**Gate Checkpoints (Phases 1-5):**
- Gate 1 (after 1.01-1.03) blocks 2.02, 2.03
- Gate 2 (after 2.01-2.03) blocks 2.04
- Gate 3 (after 2.04) blocks Phase 3
- Gate 4 (after Phase 3) blocks Phase 4
- Gate 5 (after Phase 4) blocks Phase 5
- Gate 6 (after Phase 5) is release validation

**Gate Checkpoints (Phases 6-9):**
- Gate 6A (after 6.01-6.03) blocks 6.06
- Gate 6B (after Phase 6) blocks Phase 7
- Gate 7A (after 7.01-7.03) blocks 7.05, 7.06
- Gate 7B (after Phase 7) blocks Phase 8
- Gate 8A (after 8.01-8.05) blocks 8.07
- Gate 8B (after Phase 8) is release validation
- Gate 9 (after Phase 9) is manual Figma testing

See `GATE_CHECKPOINTS.md` for full test code.

---

## Token Data
Raw Figma exports are in `figma_tokens/raw/*.json` in DTCG format:
```json
{
  "Category": {
    "Subcategory": {
      "token-name": {
        "$type": "color",
        "$value": { "hex": "#657E79" }
      }
    }
  }
}
```

Transform paths to CSS variables:
- `Color.Button.Primary.primary-bg` â†’ `--color-btn-primary-bg`
- `Color.Bg.white` â†’ `--color-bg-white`
- `Font Size.heading-lg` â†’ `--font-size-heading-lg`

## Code Standards

### ALWAYS use CSS variables for styling
```javascript
// âœ… CORRECT
backgroundColor: 'var(--color-btn-primary-bg)'
color: 'var(--color-fg-heading)'
fontSize: 'var(--font-size-body-md)'

// âŒ WRONG - never hardcode
backgroundColor: '#657E79'
color: '#1a1a1a'
fontSize: '16px'
```

### Component structure
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/        # Sidebar, Header, Layout
â”‚   â”œâ”€â”€ ui/            # Reusable: Button, Card, Badge, etc.
â”‚   â”œâ”€â”€ themes/        # Theme management feature
â”‚   â”‚   â”œâ”€â”€ import/    # Import wizard components
â”‚   â”‚   â”œâ”€â”€ create/    # Creation wizard components
â”‚   â”‚   â”œâ”€â”€ editor/    # Theme editor components
â”‚   â”‚   â””â”€â”€ export/    # Export components
â”‚   â”œâ”€â”€ export/        # Package export (Phase 7)
â”‚   â”œâ”€â”€ dashboard/     # Dashboard components (Phase 7)
â”‚   â””â”€â”€ features/      # Other feature-specific components
â”œâ”€â”€ pages/             # Route pages
â”œâ”€â”€ lib/               # Utilities, API clients, helpers
â”‚   â”œâ”€â”€ ai/            # AI code generation (Phase 6)
â”‚   â”œâ”€â”€ export/        # Package export (Phase 7)
â”‚   â”œâ”€â”€ aiExport/      # AI platform export (Phase 8)
â”‚   â”œâ”€â”€ dashboard/     # Dashboard stats (Phase 7)
â”‚   â”œâ”€â”€ themeService.js
â”‚   â”œâ”€â”€ tokenParser.js
â”‚   â””â”€â”€ exportGenerators.js
â”œâ”€â”€ hooks/             # Custom React hooks
â””â”€â”€ __tests__/         # Test files
```

### File naming
- Components: `PascalCase.jsx` (e.g., `ColorSwatch.jsx`)
- Utilities: `camelCase.js` (e.g., `tokenData.js`)
- Types: `camelCase.ts` (e.g., `types.ts`)
- Hooks: `use*.js` (e.g., `useTheme.js`)
- Tests: `*.test.jsx` alongside component

### Every component needs tests
```javascript
// ComponentName.test.jsx
import { describe, it, expect } from 'vitest'
import { render, screen } from '@testing-library/react'
import ComponentName from './ComponentName'

describe('ComponentName', () => {
  it('renders correctly', () => {
    render(<ComponentName />)
    expect(screen.getByText('...')).toBeInTheDocument()
  })
})
```

## Theme Classes
Apply themes via CSS class on root element:
- `theme-health-sem`
- `theme-home-sem`
- `theme-llm`
- `theme-forbes-media-seo`
- `theme-advisor-sem-compare-coverage`

## Component Status Workflow
```
pending_code â†’ generated â†’ approved â†’ published
     â†“             â†“           â†“
  (sync from   (AI generates  (human      (included
   Figma)       React code)   reviews)    in export)
```

## Database Schema (Supabase)

### Existing Tables
```sql
components (id, figma_id, name, description, status, variants, prop_types, tokens_used, snapshot_url, figma_url, react_code, created_at, updated_at)
tokens (id, theme, category, name, value, css_variable)
```

### Theme Management Tables
```sql
themes (id, name, slug, description, status, source, source_file_name, created_at, updated_at, published_at)
theme_tokens (id, theme_id, category, subcategory, group_name, name, value, css_variable, figma_variable_id, sort_order, created_at, updated_at)
```

## Task Execution

### For Theme Management Chunks
1. Read `docs/theme-management/chunks/chunk-X_YY.md` completely
2. Check **Dependencies** section â€” all must be complete
3. Note **Inputs/Outputs** â€” what you receive and must produce
4. Follow **Implementation Notes** â€” especially Gotchas
5. Create all files listed in **Files Created**
6. Implement all tests from **Tests** section
7. Run verification steps
8. Update status in `03-chunk-index.md`

## Dependencies
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "lucide-react": "^0.294.0",
    "@supabase/supabase-js": "^2.38.0",
    "@monaco-editor/react": "^4.6.0",
    "jszip": "^3.10.1",
    "file-saver": "^2.0.5"
  },
  "devDependencies": {
    "vitest": "^1.0.0",
    "@testing-library/react": "^14.1.0",
    "@testing-library/jest-dom": "^6.1.0",
    "playwright": "^1.40.0",
    "@types/file-saver": "^2.0.7"
  }
}
```

## Key Commands
```bash
npm run dev          # Start dev server
npm test             # Run tests
npm run build        # Production build

# Gate tests
npm test tests/integration/gate-6a.test.ts

# Phase 8 MCP server
cd mcp-server && npm run build

# Phase 9 Figma plugin
cd figma-variables-exporter && npm run build
```

## Common Patterns

### Theme Service
```javascript
import { getThemes, createTheme, bulkCreateTokens } from '../lib/themeService'
const themes = await getThemes()
const theme = await createTheme({ name, slug, description })
await bulkCreateTokens(tokens.map(t => ({ ...t, theme_id: theme.id })))
```

### AI Code Generation (Phase 6)
```javascript
import { generateComponentCode, isAIConfigured } from '../lib/ai/generateCode'
if (!isAIConfigured()) return
const result = await generateComponentCode({ component, feedback })
```

## Don't
- Don't hardcode colors, sizes, or spacing
- Don't skip writing tests
- Don't implement multiple chunks at once
- Don't proceed with failing tests
- Don't skip chunk dependencies
- Don't hardcode thresholds â€” use config reference
